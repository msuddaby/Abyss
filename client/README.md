# Abyss Client

React + TypeScript + Vite web client, with Capacitor for iOS/Android builds.

## Development

### Web

```bash
npm run dev
```

Starts Vite dev server on `http://localhost:5173`. Uses `VITE_API_URL` from the root `.env` for API requests.

### Mobile (Capacitor)

**First time setup:**

```bash
npx cap sync
```

**Dev workflow (two terminals):**

Terminal 1 — start the HTTPS dev server with API proxy:
```bash
npm run dev:mobile
```

Terminal 2 — open in Xcode/Android Studio:
```bash
npx cap open ios
# or
npx cap open android
```

Then hit Cmd+R in Xcode to run on a simulator or device. The app loads from the Vite dev server with hot reload.

`dev:mobile` enables HTTPS (required for `getUserMedia` in the WebView) and proxies `/api` and `/hubs` requests to `http://localhost:5000` to avoid mixed content issues.

**Production build:**

```bash
npm run cap:ios      # build + sync + open Xcode
npm run cap:android  # build + sync + open Android Studio
```

### Scripts

| Script | Description |
|---|---|
| `dev` | Vite dev server (HTTP, for web development) |
| `dev:mobile` | Vite dev server (HTTPS + API proxy, for Capacitor) |
| `build` | Production web build |
| `build:mobile` | Production build for Capacitor (relative asset paths) |
| `cap:sync` | Build + sync web assets to native projects |
| `cap:ios` | Build + sync + open Xcode |
| `cap:android` | Build + sync + open Android Studio |

### Notes

- The iOS project (`ios/`) and Android project (`android/`) are committed to git, but the built web assets inside them (`ios/App/App/public`, `android/app/src/main/assets/public`) are gitignored — they're generated by `cap sync`.
- When using `dev:mobile`, you only need to re-run `npx cap sync` if you change `capacitor.config.ts`, add/remove plugins, or modify native files (Info.plist, etc.). Code changes are served live by Vite.
- Set your Mac's local IP in `capacitor.config.ts` → `server.url` for on-device testing. Comment it out for production builds.
